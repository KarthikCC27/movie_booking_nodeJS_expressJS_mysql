<html>
  <head>
    <title>Form</title>
    <link rel="stylesheet" href="css/main.css"/>
  </head>
  
  <body>
    <div class="back"><h1>Movie Ticket Booking</h1></div>
    <form id="myForm">
      <button type="button" onclick="showMovies()">show movies</button
      ><br /><br />
      <label>enter no of tickets:</label>
      <input type="text" id="no_of_tickets" /><br /><br />
      <button type="button" onclick="bookTicket()">Submit</button>
      <select id="movies"></select>
    </form>

    <script>
      async function showMovies() {
        const xyz = document.getElementById("movies");
        try {
          const response = await fetch("/showMovies", {
            method: "GET",
            headers: { "Content-Type": "application/json" },
          });
          if (response.ok) {
            const result = await response.json();
            xyz.innerHTML = result;
          }
        } catch {
          (error) => {
            console.error("Error sending value:", error);
          };
        }
      }
      async function bookTicket() {
        const no_of_tickets = document.getElementById("no_of_tickets").value;
        const sel = document.querySelector("#movies");
        let optvalue = sel.value
        let movieticket = {movie:optvalue,num : no_of_tickets};
        console.log(movieticket);
        try {
          const response = await fetch("/bookTicket", {
            method: "POST",
            body: JSON.stringify({movieticket}),
            headers: { "Content-Type": "application/json" },
          });
          if (response.ok) {
            console.log("ticket booked");
          }
        } catch {
          (error) => {
            console.log("Error sending value", error);
          };
        }
      }
    </script>
  </body>
</html>
